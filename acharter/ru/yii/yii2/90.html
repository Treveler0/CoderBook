
<!DOCTYPE html>

<html lang="ru">

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <link rel="stylesheet" type="text/css" href="../../../../css/read.css" />
    <title>Coder Book menu</title>
    <script type="text/javascript" src="../../../../higtline/scripts/shCore.js"></script>
    <script type="text/javascript" src="../../../../higtline/scripts/shBrushCSharp.js"></script>
    <link type="text/css" rel="stylesheet" href="../../../../higtline/styles/shCoreDefault.css"/>
    <script type="text/javascript">SyntaxHighlighter.all();</script>
    <script src="../../../../js/Hyphenator.js" type="text/javascript"></script>
</head>

<body id="pageBody" class="hyphenate">

<!-- progress bar -->
<script src="../../../../js/progressBar.js" type="text/javascript"></script>
<div class="Reading-progress" id="progressBarType1"><span id="Progress-bar-top" class="bar-top" style="display: block !important;"></span></div>
<div class="Reading-progress" id="progressBarType2"><span id="Progress-bar-bottom" class="bar-bottom"></span></div>
<div class="Reading-progress" id="progressBarType3"><span id="Progress-bar-left" class="bar-left"></span></div>
<div class="Reading-progress" id="progressBarType4"><span id="Progress-bar-right" class="bar-right"></span></div>
<!-- progress bar -->


    <div id="lesonPage">

        <div id="lessMenu">
           <a id="exitLess" href="list.html" ontouchstart="return true;"><img src="../../../../img/menu/ex.png" /></a>
           <div id="aaLess" ontouchstart="return true;" onclick="OpenSettMenu();"><img src="../../../../img/menu/aa.png" /></div>
           <div id="subMenuInLess" style="display: none;">
                <a href="../../../../menu/setfontsize-ru.html" ontouchstart="return true;" id="pastMenuInLess">Размер текста</a>
                <a href="../../../../menu/setcolor-ru.html" ontouchstart="return true;" id="pastMenuInLess">Цветовая темы</a>
                <a href="../../../../menu/setProgressBar-ru.html" ontouchstart="return true;" id="pastMenuInLess" style="border: none;">Прогресс бар</a>
           </div>
           <div id="aaLess" ontouchstart="return true;">
            <div class="bmEdit" onclick="dellBm();" id="bma1296" ontouchstart="return true;" style="display: none;"><img src="../../../../img/menu/bmlessa.png" /></div>
            <div class="bmEdit" onclick="setzBm();" id="bm1296" ontouchstart="return true;" style="display: block;"><img src="../../../../img/menu/bmless.png" /></div>
           </div>
        </div>

        <hr />

	<!-- ПОЧАТОК -->
	
	<h1 id="title">
		Консольные команды
	</h1>

    <p>Кроме богатых возможностей для построения веб приложений, Yii также имеет полноценную поддержку консольных приложений, которые обычно используются для создания фоновых и служебных задач, поддерживающих сайт.</p>
    <p>Структура консольных приложений очень похожа на структуру веб приложения. Она состоит из одного и более классов [[yii\console\Controller]], которые часто называют командами в консольной среде.</p>
    <p>Каждый контроллер может иметь одно или более действий, как и веб контроллеры.</p>
    <p>В обоих шаблонах проектов уже есть консольное приложение.</p>
    <p>Вы можете запустить его, вызвав скрипт yii, который находится в основной директории вашего приложения.</p>
    <p>Вы получите список доступных команд, если вызовете его без параметров:</p>

    <img src="y23.png" id="image" />

    <p>Как вы можете видеть на скриншоте, в Yii уже определён набор доступных по умолчанию команд:</p>

    <pre class="brush: csharp;">
    [[yii\console\controllers\AssetController|AssetController]]
    </pre>

    <p>Позволяет вам объединять и сжимать ваши JavaScript и CSS файлы.</p>
    <p>Больше об этой команде вы можете узнать в Assets Section.</p>

    <pre class="brush: csharp;">
    [[yii\console\controllers\CacheController|CacheController]]
    </pre>

    <p>Позволяет вам сбрасывать кеш приложения.</p>

    <pre class="brush: csharp;">
    [[yii\console\controllers\FixtureController|FixtureController]]
    </pre>

    <p>Управляет загрузкой и выгрузкой данных фикстур для тестирования.</p>
    <p>Данная команда более подробно описана в Testing Section about Fixtures.</p>

    <pre class="brush: csharp;">
    [[yii\console\controllers\HelpController|HelpController]]
    </pre>

    <p>Обеспечивает справочную информацию о консольных командах, это команда по умолчанию и она печатает текст, который вы видели выше.</p>

    <pre class="brush: csharp;">
    [[yii\console\controllers\MessageController|MessageController]]
    </pre>

    <p>Извлекает сообщения для перевода из файлов с исходными тестами.</p>
    <p>Больше об этой команде вы можете узнать в I18N Section.</p>

    <pre class="brush: csharp;">
    [[yii\console\controllers\MigrateController|MigrateController]]
    </pre>

    <p>Управление миграциями приложения.</p>
    <p>Миграции базы данных более детально описаны в Database Migration Section.</p>

    <pre class="brush: csharp;">
    [[yii\console\controllers\ServeController|ServeController]]
    </pre>

    <p>Позволяет запускать встроенный вебсервер PHP.</p>

    <h2 id="title">
        Использование
    </h2>

    <p>Вы можете запустить действие консольного контроллера, используя следующий синтаксис:</p>

    <pre class="brush: csharp;">
    yii &lt;route&gt; [--option1=value1 --option2=value2 ... argument1 argument2 ...]
    </pre>

    <p>В приведённом выше примере, &lt;route&gt; относится к действию контроллера.</p>
    <p>Параметры будут подставляться в свойства класса и в аргументы метода действия.</p>

    <p>Для примера,</p>

    <pre class="brush: csharp;">
    [[yii\console\controllers\MigrateController::actionUp()|MigrateController::actionUp()]]
    </pre>

    <p>с</p>

    <pre class="brush: csharp;">
    [[yii\console\controllers\MigrateController::$migrationTable|MigrateController::$migrationTable]]
    </pre>

    <p>установкой migrations и лимитом в 5 миграций может быть вызвано следующим образом:</p>

    <pre class="brush: csharp;">
    yii migrate/up 5 --migrationTable=migrations
    </pre>

    <p><b>Примечание:</b> При использовании в консоли *, не забудьте поместить её в кавычки "*" чтобы избежать её интерпретации и замены на все имена файлов в данной директории.</p>

    <h2 id="title">
        Входной скрипт
    </h2>

    <p>Входной скрипт консольного приложения - это подобие файла index.php, используемого в веб приложении.</p>
    <p>Входной скрипт консоли, как правило, называется yii и располагается в основной директории приложения.</p>
    <p>Он содержит код похожий на следующее:</p>

    <pre class="brush: csharp;">
    #!/usr/bin/env php
    &lt;?php
    /**
     * Yii console bootstrap file.
     */
    
    defined('YII_DEBUG') or define('YII_DEBUG', true);
    defined('YII_ENV') or define('YII_ENV', 'dev');
    
    require __DIR__ . '/vendor/autoload.php';
    require __DIR__ . '/vendor/yiisoft/yii2/Yii.php';
    
    $config = require __DIR__ . '/config/console.php';
    
    $application = new yii\console\Application($config);
    $exitCode = $application->run();
    exit($exitCode);
    </pre>

    <p>Этот скрипт будет создан как часть вашего приложения; вы можете его редактировать, если вам это необходимо.</p>
    <p>YII_DEBUG можете установить в false если вам не нужно видеть отладочный вывод при ошибке, и/или если вы хотите улучшить общую производительность.</p>
    <p>В обоих шаблонах приложения, во входном скрипте приложения отладка включена по умолчанию для обеспечения более дружественного к разработчику окружения.</p>

    <h2 id="title">
        Настройка
    </h2>

    <p>Как видно из приведённого выше кода, консольное приложение использует свой собственный файл конфигурации, названый console.php.</p>
    <p>В этом файле вы должны произвести настройку различных компонентов приложения и свойств консольного приложения.</p>
    <p>Если ваше веб и консольное приложение имеет много общих параметров конфигурации, вы можете выделить общую часть в отдельный файл, и включить его в оба файла конфигурации (веб и консоль).</p>
    <p>Вы можете посмотреть пример в "продвинутом" шаблоне проекта.</p>
    <p><b>Подсказка:</b> Иногда, вам может потребоваться запустить консольную команду используя конфигурацию, отличную от той, что указано во входном скрипте. Для примера, вы можете использовать команду yii migrate для обновления тестовой базы данных, которая настраивается для каждого отдельного набора тестов. Для изменения файла конфигурации, просто укажите свой конфигурационный файл через опцию appconfig при запуске команды:</p>

    <pre class="brush: csharp;">
    yii &lt;route&gt; --appconfig=path/to/config.php ...
    </pre>

    <h2 id="title">
        Автодополнение консольных команд
    </h2>

    <p>Автодополнение аргументов команд является полезной возможностью при работе в командной строке.</p>
    <p>Начиная с версии 2.0.11, команда ./yii поддерживает автодополнение для Bash и ZSH.</p>

    <h3 id="title">
        Автодополнение для Bash
    </h3>

    <p>Убедитесь, что средства автодополнения для Bash установлены.</p>
    <p>В большинстве дистрибутивов они поставляются по умолчанию.</p>
    <p>Сохраните скрипт для автодополнения в директорию /etc/bash_completion.d/:</p>

    <pre class="brush: csharp;">
    curl -L https://raw.githubusercontent.com/yiisoft/yii2/master/contrib/completion/bash/yii -o /etc/bash_completion.d/yii
    </pre>

    <p>Для временного использования, вы можете сохранить файл в произвольную директорию и подключить его на время работы сессии, вызвав команду source yii.</p>
    <p>Если скрипт был установлен глобально, вам потребуется перезапустить терминал или выполнить команду source ~/.bashrc для активации автодополнения.</p>
    <p>Обратитесь к инструкции по автодополнению в Bash чтобы узнать о других способах подключения скриптов автодополнения в ваше окружение.</p>

    <h3 id="title">
        Автодополнение для ZSH
    </h3>

    <p>Сохраните скрипт автодополнения в директорию для скриптов автодополнения.</p>
    <p>Например, ~/.zsh/completion/</p>

    <pre class="brush: csharp;">
    mkdir -p ~/.zsh/completion
    curl -L https://raw.githubusercontent.com/yiisoft/yii2/master/contrib/completion/zsh/_yii -o ~/.zsh/completion/_yii
    </pre>

    <p>Добавьте эту директорию в переменную среды $fpath, например добавив в конец ~/.zshrc следующую строку:</p>

    <pre class="brush: csharp;">
    fpath=(~/.zsh/completion $fpath)
    </pre>

    <p>Убедитесь, что программа compinit запущена.</p>
    <p>Если это не так - добавьте в ~/.zshrc следующие строки:</p>

    <pre class="brush: csharp;">
    autoload -Uz compinit && compinit -i
    </pre>

    <p>Затем перезапустите ваш терминал, либо выполните команду</p>

    <pre class="brush: csharp;">
    exec $SHELL -l
    </pre>

    <h2 id="title">
        Создание ваших собственных команд
    </h2>

    <h3 id="title">
        Консольный контроллер и действие
    </h3>

    <p>Консольная команда определяется как класс контроллера расширяющий [[yii\console\Controller]].</p>
    <p>В классе контроллера, вы определяете одно или несколько действий, которые соответствуют суб-командам контроллера.</p>
    <p>В каждом действии вы пишете код, который реализует соответствующие данной суб-команде задачи.</p>
    <p>При запуске команды, вам необходимо указать маршрут к действию.</p>
    <p>Например, маршрут migrate/create вызывает суб-команду, которая соответствует методу</p>

    <pre class="brush: csharp;">
    [[yii\console\controllers\MigrateController::actionCreate()|MigrateController::actionCreate()]]
    </pre>

    <p>Если маршрут, предложенный при вызове команды, не содержит указания идентификатора действия, будет вызвано действие по умолчанию (так же как и в веб приложении).</p>

    <h3 id="title">
        Опции
    </h3>

    <p>Для переопределения [[yii\console\Controller::options()]] метода, вы можете указать опции, которые доступны в консольной команде (controller/actionID).</p>
    <p>Метод должен возвращать список публичных атрибутов класса.</p>
    <p>При запуске команды вы можете указать значение опций, используя синтаксис --OptionName=OptionValue.</p>
    <p>Это свяжет OptionValue с атрибутом OptionName класса контроллера.</p>
    <p>Если значение по умолчанию опции - это массив, то при установке этой опции, при выполнении команды, значение будет преобразовано в массив путём разделения входящей строки по запятым.</p>

    <h3 id="title">
        Аргументы
    </h3>

    <p>Кроме опций, команда может получать аргументы.</p>
    <p>Аргументы будут переданы в качестве параметров в метод действия, соответствующего запрошенной суб-команде.</p>
    <p>Первый аргумент соответствует первому параметру, второй соответственно второму, и так далее.</p>
    <p>Если переданных аргументов при вызове команды будет недостаточно, то параметрам будут назначены по умолчанию, если они определены.</p>
    <p>Если значения по умолчанию не определены, и не были переданы, команда завершит выполнение с ошибкой.</p>
    <p>Вы можете использовать указание типа array, чтобы указать, что аргумент должен рассматриваться как массив.</p>
    <p>Массив будет сгенерирован путём разделения входной строки по запятым.</p>

    <h3 id="title">
        Псевдонимы опций
    </h3>

    <p>Начиная с версии 2.0.8 в классе консольной команды доступен метод [[yii\console\Controller::optionAliases()]], позволяющий добавлять псевдонимы для опций.</p>
    <p>Для того, чтобы задать псевдоним, перекройте метод [[yii\console\Controller::optionAliases()]] в вашем контроллере:</p>

    <pre class="brush: csharp;">
    namespace app\commands;
    
    use yii\console\Controller;
    
    class HelloController extends Controller
    {
        public $message;
        
        public function options($actionID)
        {
            return ['message'];
        }
        
        public function optionAliases()
        {
            return ['m' =&gt; 'message'];
        }
        
        public function actionIndex()
        {
            echo $this->message . "\n";
        }
    }
    </pre>

    <p>Теперь для запуска команды можно использовать следующий синтаксис:</p>

    <pre class="brush: csharp;">
    yii hello -m=hello
    </pre>

    <p>Следующий пример показывает как описывать аргументы:</p>

    <pre class="brush: csharp;">
    class ExampleController extends \yii\console\Controller
    {
        // Команда "yii example/create test" вызовет "actionCreate('test')"
        public function actionCreate($name) { ... }
    
        // Команда "yii example/index city" вызовет "actionIndex('city', 'name')"
        // Команда "yii example/index city id" вызовет "actionIndex('city', 'id')"
        public function actionIndex($category, $order = 'name') { ... }
    
        // Команда "yii example/add test" вызовет "actionAdd(['test'])"
        // Команда "yii example/add test1,test2" вызовет "actionAdd(['test1', 'test2'])"
        public function actionAdd(array $name) { ... }
    }
    </pre>

    <h3 id="title">
        Код возврата
    </h3>

    <p>При разработке консольного приложения принято использовать код возврата.</p>
    <p>Принято, код 0 означает, что команда выполнилась удачно.</p>
    <p>Если команда вернула код больше нуля, то это говорит об ошибке.</p>
    <p>Номер, который был возвращён при ошибке, потенциально может быть использован для поиска более детальной информации об ошибке.</p>
    <p>Для примера 1 может указывать на неизвестную ошибку, а все коды выше могут быть зарезервированы под специфичные ошибки: ошибки ввода, повреждённые файлы, и что-то другое.</p>
    <p>Для того, чтобы ваша консольная команда возвращала код возврата, просто верните целое число в методе действия контроллера:</p>

    <pre class="brush: csharp;">
    public function actionIndex()
    {
        if (/* возникла проблема */) {
            echo "Возникла проблема!\n";
            return 1;
        }
        // делаем что-нибудь
        return 0;
    }
    </pre>

    <p>Есть несколько предопределённых констант, которые вы можете использовать:</p>

    <pre class="brush: csharp;">
    [[yii\console\Controller::EXIT_CODE_NORMAL|Controller::EXIT_CODE_NORMAL]]
    </pre>

    <p>со значением 0;</p>

    <pre class="brush: csharp;">
    [[yii\console\Controller::EXIT_CODE_ERROR|Controller::EXIT_CODE_ERROR]]
    </pre>

    <p>со значением 1.</p>
    <p>Хорошая практика, определять значимые для вашего контроллера константы в случае, если вы используете больше типов ошибок.</p>

    <h3 id="title">
        Форматирование и цвета
    </h3>

    <p>Консоль Yii поддерживает форматирование вывода, который автоматически деградирует до не форматированного, если это не поддерживается в терминале, где запускается команда.</p>
    <p>Вывод форматированных строк прост.</p>
    <p>Вот как можно вывести некоторый жирный текст:</p>

    <pre class="brush: csharp;">
    $this->stdout("Hello?\n", Console::BOLD);
    </pre>

    <p>Если вам нужно собрать строку динамически объединяя несколько стилей, лучше использовать [[yii\helpers\Console::ansiFormat()|ansiFormat()]]:</p>

    <pre class="brush: csharp;">
    $name = $this->ansiFormat('Alex', Console::FG_YELLOW);
    echo "Hello, my name is $name.";
    </pre>

	<script src="../../../../js/progressBarSetIni.js" type="text/javascript"></script>

        <div id="lessMenu" style="margin: 30px 0 0 0;">
            <hr />
            <a href="89.html"><div id="exitLess" ontouchstart="return true;"><img src="../../../../img/menu/pr.png" /></div></a>
            <a href="91.html"><div id="aaLess" ontouchstart="return true;"><img src="../../../../img/menu/ne.png" /></div></a>
        </div>

    </div>

    <script type="text/javascript" src="../../../../cordova.js"></script>
    <script type="text/javascript" src="../../../../js/global.js"></script>
    <script type="text/javascript">
        changeColor();
        if (localStorage.getItem("fSize") < 1) { fSize = 16; localStorage.setItem("fSize", 16); } else { fSize = localStorage.getItem("fSize"); }
        document.getElementById("pageBody").style.fontSize = fSize + "px";

        // goBackMenu
        document.addEventListener("backbutton", goBackMenu, false);
        function goBackMenu()
        {
            window.location.href = 'list.html';
        }

        function changeColor()
        {
            if (localStorage.getItem("colorSheme") <= 1)
            {
                document.getElementById("pageBody").style.backgroundColor = localStorage.getItem("#f0f0f0");
            }

            if (localStorage.getItem("colorSheme") == 2)
            {
                document.getElementById("pageBody").style.backgroundColor = localStorage.getItem("#212121");
                document.getElementById("pageBody").style.color = localStorage.getItem("#efefef");
            }

            if (localStorage.getItem("colorSheme") == 3)
            {
                document.getElementById("pageBody").style.backgroundColor = localStorage.getItem("#efe4d0");
            }
        }

        // bm
        if (localStorage.getItem("arrs") != null)
        {
            var arrs = JSON.parse(localStorage.getItem("arrs"));
        }
        else
        {
            var arrs = [];
        }

        var names = ["../acharter/ru/yii/yii2/90.html", "Yii2: Консольные команды", "bm1296"];

        function setzBm() { arrs.push(names); localStorage.setItem("arrs", JSON.stringify(arrs)); localStorage.setItem("bm1296", 1); RefBms(); }

        window.onload = function() { RefBms(); }

        function RefBms()
        {
            if (localStorage.getItem("bm1296") == 1) { document.getElementById("bma1296").style.display = "block"; document.getElementById("bm1296").style.display = "none"; } else { document.getElementById("bma1296").style.display = "none"; document.getElementById("bm1296").style.display = "block"; }
        }

        function dellBm() { for (var i = 0; i < arrs.length; i++) { if (arrs[i].indexOf("Yii2: Консольные команды") == 1) { arrs.splice(i, 1); localStorage.setItem("bm1296", 0); RefBms(); localStorage.setItem("arrs", JSON.stringify(arrs)); } } }

        // sub menu
        var serTimeToClose = 1000;
        
        function OpenSettMenu()
        {
            document.getElementById("subMenuInLess").style.display = "block";
            timeToEvAct();
            serTimeToClose = 1;
        }
        
        function timeToEvAct()
        {
            setTimeout(function() { serTimeToClose = 0 }, 100);
        }
        
        window.addEventListener('click', function(e){
        
            if (serTimeToClose <= 0)
            {
                if (document.getElementById('subMenuInLess').contains(e.target))
                {
                    //
                }
                else
                {
                    document.getElementById("subMenuInLess").style.display = "none";
                }
            }
        });

    </script>

</body>
</html>
