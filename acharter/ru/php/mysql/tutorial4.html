<!DOCTYPE html><html lang="ru"><head>    <meta charset="utf-8" />    <meta name="format-detection" content="telephone=no" />    <meta name="msapplication-tap-highlight" content="no" />    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />    <link rel="stylesheet" type="text/css" href="../../../../css/read.css" />    <title>Coder Book menu</title>    <script type="text/javascript" src="../../../../higtline/scripts/shCore.js"></script>    <script type="text/javascript" src="../../../../higtline/scripts/shBrushCSharp.js"></script>    <link type="text/css" rel="stylesheet" href="../../../../higtline/styles/shCoreDefault.css"/>    <script type="text/javascript">SyntaxHighlighter.all();</script>    <script src="../../../../js/Hyphenator.js" type="text/javascript"></script></head><body id="pageBody" class="hyphenate"><!-- progress bar --><script src="../../../../js/progressBar.js" type="text/javascript"></script><div class="Reading-progress" id="progressBarType1"><span id="Progress-bar-top" class="bar-top" style="display: block !important;"></span></div><div class="Reading-progress" id="progressBarType2"><span id="Progress-bar-bottom" class="bar-bottom"></span></div><div class="Reading-progress" id="progressBarType3"><span id="Progress-bar-left" class="bar-left"></span></div><div class="Reading-progress" id="progressBarType4"><span id="Progress-bar-right" class="bar-right"></span></div><!-- progress bar -->    <div id="lesonPage">        <div id="lessMenu">           <a id="exitLess" href="list.html" ontouchstart="return true;"><img src="../../../../img/menu/ex.png" /></a>           <div id="aaLess" ontouchstart="return true;" onclick="OpenSettMenu();"><img src="../../../../img/menu/aa.png" /></div>           <div id="subMenuInLess" style="display: none;">                <a href="../../../../menu/setfontsize-ru.html" ontouchstart="return true;" id="pastMenuInLess">Размер текста</a>                <a href="../../../../menu/setcolor-ru.html" ontouchstart="return true;" id="pastMenuInLess">Цветовая темы</a>                <a href="../../../../menu/setProgressBar-ru.html" ontouchstart="return true;" id="pastMenuInLess" style="border: none;">Прогресс бар</a>           </div>           <div id="aaLess" ontouchstart="return true;">            <div class="bmEdit" onclick="dellBm();" id="bma900" ontouchstart="return true;" style="display: none;"><img src="../../../../img/menu/bmlessa.png" /></div>            <div class="bmEdit" onclick="setzBm();" id="bm900" ontouchstart="return true;" style="display: block;"><img src="../../../../img/menu/bmless.png" /></div>           </div>        </div>        <hr />	<!-- ПОЧАТОК -->		<h1 id="title">		Функции PHP для работы с MySQL	</h1>		<p>Рассмотрим основные функции PHP, применяемые для работы с MySQL сервером.</p>		<h1 id="title">		Функции соединения с сервером MySQL	</h1>		<p>Основной функцией для соединения с сервером MySQL является mysql_connect(), которая подключает скрипт к серверу баз данных MySQL и выполяет авторизацию пользователя базой данных.</p>	<p>Синтаксис у данной функции такой:</p>	<pre class="brush: csharp;">		mysql_connect ([string $hostname] [, string $user] [, sting $password]);	</pre>	<p>Как вы наверно заметили, все параметры данной функции являются необязательными, поскольку значения по умолчанию можно прописать в конфигурационном файле php.ini.</p>	<p>Если вы хотите указать другие имя MySQL-хоста, пользователя и пароль, вы всегда можете это сделать.</p>	<p>Параметр $hostname может быть указан в виде: хост:порт.</p>	<p>Функция возвращает идентификатор (типа int) соединения, вся дальнейщая работа осуществляется только через этот идентификатор.</p>	<p>При следующем вызове функции <b>mysql_connect()</b> с теми же параметрами новое соединение не будет открыто, а функция возвратит идентификатор существующего соединения.</p>	<p>Для закрытия соединения предназначена функция <b>mysql_close(int $connection_id)</b>.</p>	<p>Вообще, соединение можно и не закрывать - оно будет закрыто автоматически при завершении работы PHP скрипта.</p>	<p>Если вы используете более одного соединения, при вызове mysql_close() нужно указать идентификатор соединения, которое вы хотите закрыть.</p>	<p>Вообще не закрывать соединения - плохой стиль, лучше закрывать соединения с MySQL самостоятельно, а не надеясь на автоматизм PHP, хотя это ваше право.</p>	<p>Если вы будете использовать только одно соединение с базой данных MySQL за все время работы сценария, можно не сохранять его идентификатор и не указывать идентификатор при вызове остальных функций.</p>	<p>Функция mysql_connect() устанавливает обыкновенное соединение с MySQL.</p>	<p>Однако, PHP поддерживает постоянные соединения - для этого используйте функцию <b>mysql_pconnect()</b>.</p>	<p>Аргументы этой функции такие же, как и у mysql_connect().</p>	<p>В чем разница между постоянным соединением и обыкновенным соединением с MySQL?</p>	<p>Постоянное соединение не закрывается после завершения работы скрипта, даже если скрипт вызвал функцию <b>mysql_close()</b>.</p>	<p>Соединение привязывается к PID потомка веб сервера Apache (от имени которого он и работает) и закрывается лишь тогда, когда удаляется процесс-владелец (например, при завершении работы или перезагрузке веб-сервера Apache).</p>	<p>PHP работает с постоянными соединениями примерно так: при вызове функции mysql_pconnect() PHP проверяет, было ли ранее установлено соединение.</p>	<p>Если да, то возвращается его идентификатор, а если нет, то открывается новое соединение и возвращается идентификатор.</p>	<p>Постоянные соединения позволяют значительно снизить нагрузку на сервер, а также повысить скорость работы PHP скриптов, использующих базы данных.</p>	<p>При работе с постоянными соединениями нужно следить, чтобы максимальное число клиентов Apache не преывшало максимального числа клиентов MySQL, то есть параметр <b>MaxClient</b> (в конфигурационном файле Apache - httpd.conf) должен быть меньше или равен параметру max_user_connection (параметр MySQL).</p>		<h1 id="title">		Функция выбора базы данных	</h1>		<p>Функция <b>mysql_select_db (string $db [, int $id])</b> выбирает базу данных, с которой будет работать PHP скрипт.</p>	<p>Если открыто не более одного соединения, можно не указывать параметр $id.</p>		<pre class="brush: csharp;">		// Попытка установить соединение с MySQL:		if (!mysql_connect($server, $user, $ password))		{			echo "Ошибка подключения к серверу MySQL";			exit;		}		// Соединились, теперь выбираем базу данных:		mysql_select_db($db);	</pre>		<h1 id="title">		Функции обработки ошибок	</h1>		<p>Если произойдет ошибка соединения с MySQL, то вы получите соответствующее сообщение и скрипт завершит свою работу.</p>	<p>Это не всегда бывает удобно, прежде всего, при отладке скриптов.</p>	<p>Поэтому, в PHP есть следующие две функции:</p>	<pre class="brush: csharp;">		- mysql_errno(int $id);		- mysql_error(int $id);	</pre>	<p>Первая функция возвращает номер ошибки, а вторая - сообщение об ошибке.</p>	<p>В результате мы можем использовать следующее:</p>	<pre class="brush: csharp;">		echo "ERROR ".mysql_errno()." ".mysql_error()."\n";	</pre>	<p>Теперь вы будете знать, из-за чего произошла ошибка - вы увидите соответствующим образом оформленное сообщение.</p>		<h1 id="title">		Функции выполнения запросов к серверу баз данных	</h1>		<p>Все запросы к текущей базе данных отправляются функцией <b>mysql_query()</b>.</p>	<p>Этой функции нужно передать один параметр - текст запроса.</p>	<p>Текст запроса модет содержать пробельные символы и символы новой строки (\n).</p>	<p>Текст должен быть составлен по правилам синтаксиса SQL.</p>	<p>Пример запроса:</p>	<pre class="brush: csharp;">		$q = mysql_query("SELECT * FROM mytable");	</pre>	<p>Приведенный запрос должен вернуть содержимое таблицы mytable.</p>	<p>Результат запроса присваивается переменной $q.</p>	<p>Результат - это набор данных, который после выполнения запроса нужно обработать определенным образом.</p>		<h1 id="title">		Функции обработки результатов запроса	</h1>	<p>Если запрос, выполненный с помощью функции mysql_query() успешно выполнился, то в результате клиент получит набор записей, который может быть обработан следующими функциями PHP:</p>	<p>- mysql_result() - получить необходимый элемент из набора записей;</p>	<p>- mysql_fetch_array() - занести запись в массив;</p>	<p>- mysql_fetch_row() - занести запись в массив;</p>	<p>- mysql_fetch_assoc() - занести запись в ассоциативный массив;</p>	<p>- mysql_fetch_object() - занести запись в объект.</p>	<p>Также можно определить количество содержащихся записей и полей в результате запроса.</p>	<p>Функция mysql_num_rows() позволяет узнать, сколько записей содержит результат запроса:</p>		<pre class="brush: csharp;">		$q = mysql_query("SELECT * FROM mytable");		echo "В таблице mytable ".mysql_num_rows($q)." записей";	</pre>		<p>Запись состоит из полей (колонок).</p>	<p>С помощью функции mysql_num_fields() можно узнать, сколько полей содержит каждая запись результата:</p>	<pre class="brush: csharp;">		$q = mysql_query("SELECT * FROM mytable");		echo "В таблице mytable ".mysql_num_fields($q)." полей ";	</pre>	<p>У нас также есть возможность узнать значение каждого поля.</p>	<p>Это можно сделать с помощью следующей функции:</p>		<pre class="brush: csharp;">		mysql_result (int $result, int $row, mixed $field);	</pre>		<p>Параметр функции $row задает номер записи, а параметр $field - имя или порядковый номер поля.</p>		<p>Следует отметить, что функция mysql_result() универсальна: зная количество записей и количество полей, можно "обойти" весь результат, но в тоже время, скорость работы данной функции достаточно низка.</p>	<p>Поэтому, для обработки больших наборов записей рекомендуется использовать функции mysql_fecth_row(), mysql_fecth_array(), и т.д.</p>	<p>Функция <b>mysql_fecth_row(int $res)</b> получает сразу всю строку, соответствующую текущей записи результата $res.</p>	<p>Каждый следующий вызов функции перемещает указатель запроса на следующую позицию (как при работе с файлами) и получает следующую запись.</p>	<p>Если более нет записей, то функция возвращает FALSE.</p>	<p>Пример использования данной функции:</p>		<pre class="brush: csharp;">		$q = mysql_query("SELECT * FROM mytable WHERE month=\"$db_m\" AND day=\"$db_d\");				for ($c=0; $c < mysql_num_rows($q); $c++)		{			$f = mysql_fetch_row($q);			echo $f;		}	</pre>		<p>Использовать функцию mysql_fecth_row() не всегда удобно, так как значения всех полей одной записи находятся все в одной строке.</p>	<p>Удобнее использовать функцию mysql_fetch_array(), которая возвращает ассоциативный массив, ключами которого будут имена полей.</p>	<p>Функция mysql_fecth_array(int $res [, int $result_type]) возвращает не ассоциативный массив, а массив, заданный необязательным параметром $result_type, который может принимать следующие значения:</p>	<p>- MYSQL_ASSOC - возвращает ассоциативный массив;</p>	<p>- MYSQL_NUM -возвращает массив с числовыми индексами, как в функции mysql_fecth_row();</p>	<p>- MYSQL_BOTH - возвращает массив с двойными индексами, то есть вы можете работать с ним, как с ассоциативным массивом и как со списком (MYSQL_BOTH - это значение по умолчанию для параметра $result_type.</p>	<p>В PHP есть функция, возвращающая ассоциативный массив с одним индексом:</p>		<pre class="brush: csharp;">		mysql_fetch_assoc(int $res);	</pre>		<p>Фактически, данная функция является синонимом для <b>mysql_fetch_array($res, MYSQL_ASSOC);</b></p>	<p>Пример использования функции mysql_fecth_array():</p>		<pre class="brush: csharp;">		$q = mysql_query("SELECT * FROM mytable WHERE month=\"$db_m\" AND day=\"$db_d\");		for ($c=0; $c < mysql_num_rows($q); $c++)		{			$f = mysql_fetch_array($q);			echo "$f[email] $f[name] $f[month] $f[day] &lt;br&gt;";		}	</pre>		<p>Как видно, использовать функцию <b>mysql_fetch_array()</b> намного удобнее, чем <b>mysql_fetch_row()</b>.</p>		<h1 id="title">		Функции получения информации о результатах SQL-запросов	</h1>		<p>HP предоставляет еще несколько полезных функций, которые позволяют узнать информацию о результах SQL-запросов.</p>	<p>- Функция <b>mysql_field_name(int $result, int $offset)</b> возвращает имя поля, находящегося в результате $result с номером $offset (нумерация начинается с 0). Другими словами, функция возвращает имя поля с номером $offset.</p>	<p>- Функция <b>mysql_field_type(int $result, int $offset)</b> возвращает тип поля с номером $offset в результате $result (номер задается относительно результата, а не таблицы);</p>	<p>- Функция <b>mysql_field_flags(int $result, int $offset)</b> возвращает пречисленные через пробел флаги (модификаторы), которые имеются у поля с номером $offset.</p>	<p>- Функция mysql_field_flags() возвращает флаги в виде строки, в которой флаги разделяются пробелами.</p>	<script src="../../../../js/progressBarSetIni.js" type="text/javascript"></script>        <div id="lessMenu" style="margin: 30px 0 0 0;">            <hr />            <a href="tutorial3.html"><div id="exitLess" ontouchstart="return true;"><img src="../../../../img/menu/pr.png" /></div></a>        </div>    </div>    <script type="text/javascript" src="../../../../cordova.js"></script>    <script type="text/javascript" src="../../../../js/global.js"></script>    <script type="text/javascript">        changeColor();        if (localStorage.getItem("fSize") < 1) { fSize = 16; localStorage.setItem("fSize", 16); } else { fSize = localStorage.getItem("fSize"); }        document.getElementById("pageBody").style.fontSize = fSize + "px";        // goBackMenu        document.addEventListener("backbutton", goBackMenu, false);        function goBackMenu()        {            window.location.href = 'list.html';        }        function changeColor()        {            if (localStorage.getItem("colorSheme") <= 1)            {                document.getElementById("pageBody").style.backgroundColor = localStorage.getItem("#f0f0f0");            }            if (localStorage.getItem("colorSheme") == 2)            {                document.getElementById("pageBody").style.backgroundColor = localStorage.getItem("#212121");                document.getElementById("pageBody").style.color = localStorage.getItem("#efefef");            }            if (localStorage.getItem("colorSheme") == 3)            {                document.getElementById("pageBody").style.backgroundColor = localStorage.getItem("#efe4d0");            }        }        // bm        if (localStorage.getItem("arrs") != null)        {            var arrs = JSON.parse(localStorage.getItem("arrs"));        }        else        {            var arrs = [];        }        var names = ["../acharter/ru/php/mysql/tutorial4.html", "Функции PHP для MySQL", "bm900"];        function setzBm() { arrs.push(names); localStorage.setItem("arrs", JSON.stringify(arrs)); localStorage.setItem("bm900", 1); RefBms(); }        window.onload = function() { RefBms(); }        function RefBms()        {            if (localStorage.getItem("bm900") == 1) { document.getElementById("bma900").style.display = "block"; document.getElementById("bm900").style.display = "none"; } else { document.getElementById("bma900").style.display = "none"; document.getElementById("bm900").style.display = "block"; }        }        function dellBm() { for (var i = 0; i < arrs.length; i++) { if (arrs[i].indexOf("Функции PHP для MySQL") == 1) { arrs.splice(i, 1); localStorage.setItem("bm900", 0); RefBms(); localStorage.setItem("arrs", JSON.stringify(arrs)); } } }        // sub menu        var serTimeToClose = 1000;                function OpenSettMenu()        {            document.getElementById("subMenuInLess").style.display = "block";            timeToEvAct();            serTimeToClose = 1;        }                function timeToEvAct()        {            setTimeout(function() { serTimeToClose = 0 }, 100);        }                window.addEventListener('click', function(e){                    if (serTimeToClose <= 0)            {                if (document.getElementById('subMenuInLess').contains(e.target))                {                    //                }                else                {                    document.getElementById("subMenuInLess").style.display = "none";                }            }        });    </script></body></html>